<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#1e1e2e">
  <title>Todo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Inter:opsz,wght@14..32,400..700&display=swap" rel="stylesheet">
  <style>
    @layer reset, tokens, base, components, a11y;

    @layer reset {
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
    }

    @layer tokens {
      :root {
        /* Catppuccin Mocha palette */
        --ctp-rosewater: #f5e0dc;
        --ctp-flamingo: #f2cdcd;
        --ctp-pink: #f5c2e7;
        --ctp-mauve: #cba6f7;
        --ctp-red: #f38ba8;
        --ctp-maroon: #eba0ac;
        --ctp-peach: #fab387;
        --ctp-yellow: #f9e2af;
        --ctp-green: #a6e3a1;
        --ctp-teal: #94e2d5;
        --ctp-sky: #89dceb;
        --ctp-sapphire: #74c7ec;
        --ctp-blue: #89b4fa;
        --ctp-lavender: #b4befe;
        --ctp-text: #cdd6f4;
        --ctp-subtext1: #bac2de;
        --ctp-subtext0: #a6adc8;
        --ctp-overlay2: #9399b2;
        --ctp-overlay1: #7f849c;
        --ctp-overlay0: #6c7086;
        --ctp-surface2: #585b70;
        --ctp-surface1: #45475a;
        --ctp-surface0: #313244;
        --ctp-base: #1e1e2e;
        --ctp-mantle: #181825;
        --ctp-crust: #11111b;

        /* Font stacks */
        --font-sans: 'Inter', system-ui, sans-serif;
        --font-mono: 'DM Mono', ui-monospace, 'Cascadia Mono', 'Fira Mono', monospace;

        /* Spacing scale */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 0.75rem;
        --space-lg: 1rem;
        --space-xl: 1.25rem;
        --space-2xl: 1.5rem;
        --space-3xl: 2rem;
        --space-4xl: 3rem;

        /* Radii */
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 12px;
        --radius-full: 999px;

        /* Touch target minimum */
        --touch-min: 44px;
      }
    }

    @layer base {
      body {
        font-family: var(--font-sans);
        font-optical-sizing: auto;
        background-color: var(--ctp-base);
        color: var(--ctp-text);
        line-height: 1.5;
        letter-spacing: -0.011em;
        min-block-size: 100dvh;
        display: flex;
        flex-direction: column;
        align-items: center;
        -webkit-tap-highlight-color: transparent;
      }

      code, kbd, samp, pre {
        font-family: var(--font-mono);
        font-size: 0.9em;
      }
    }

    @layer components {
      /* App shell */
      main.app {
        inline-size: 100%;
        max-inline-size: 600px;
        padding: var(--space-2xl) var(--space-lg) env(safe-area-inset-bottom, var(--space-2xl));
        display: flex;
        flex-direction: column;
        gap: var(--space-xl);
      }

      /* Header */
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;

        & h1 {
          font-size: clamp(1.75rem, 1.5rem + 1vw, 2.25rem);
          font-weight: 700;
          color: var(--ctp-mauve);
          letter-spacing: -0.025em;
          text-wrap: balance;
        }
      }

      .task-count {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--ctp-overlay1);
        background: var(--ctp-surface0);
        padding: var(--space-xs) var(--space-md);
        border-radius: var(--radius-full);
        letter-spacing: 0;
      }

      /* Input area */
      .input-row {
        display: flex;
        gap: var(--space-sm);

        & input {
          flex: 1;
          padding: var(--space-md) var(--space-lg);
          border: 2px solid var(--ctp-surface1);
          border-radius: var(--radius-lg);
          background: var(--ctp-surface0);
          color: var(--ctp-text);
          font-family: inherit;
          font-size: 1rem;
          line-height: 1.5;
          outline: none;
          transition: border-color 0.2s;

          &:focus {
            border-color: var(--ctp-mauve);
            outline: 2px solid var(--ctp-mauve);
            outline-offset: 2px;
          }

          &::placeholder {
            color: var(--ctp-overlay0);
          }
        }

        & button {
          padding: var(--space-md) var(--space-xl);
          border: none;
          border-radius: var(--radius-lg);
          background: var(--ctp-mauve);
          color: var(--ctp-crust);
          font-family: inherit;
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.2s, transform 0.1s;
          white-space: nowrap;

          &:hover {
            background: color-mix(in oklch, var(--ctp-mauve), var(--ctp-lavender) 50%);
          }

          &:active {
            transform: scale(0.96);
          }
        }
      }

      /* Focus outlines for keyboard navigation */
      :focus-visible {
        outline: 2px solid var(--ctp-mauve);
        outline-offset: 2px;
      }

      /* Filter tabs */
      .filters {
        display: flex;
        gap: var(--space-xs);
        background: var(--ctp-mantle);
        padding: var(--space-xs);
        border-radius: var(--radius-lg);

        & button {
          flex: 1;
          padding-block: 0.65rem;
          padding-inline: var(--space-sm);
          border: none;
          border-radius: var(--radius-md);
          background: transparent;
          color: var(--ctp-overlay1);
          font-family: inherit;
          font-size: 0.85rem;
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s, color 0.2s;
          min-block-size: var(--touch-min);

          &.active {
            background: var(--ctp-surface0);
            color: var(--ctp-text);
          }

          &:hover:not(.active) {
            color: var(--ctp-subtext0);
          }
        }
      }

      /* Todo list */
      .todo-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
      }

      .todo-item {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        padding: 0.85rem var(--space-lg);
        background: var(--ctp-surface0);
        border-radius: var(--radius-lg);
        transition: background 0.2s, opacity 0.3s, transform 0.3s;

        &.new-item {
          animation: slide-in 0.25s ease-out;
        }

        &.completed {
          opacity: 0.55;

          & .todo-text {
            text-decoration: line-through;
            color: var(--ctp-overlay0);
          }
        }
      }

      @keyframes slide-in {
        from { opacity: 0; transform: translateY(-8px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Custom checkbox */
      .checkbox {
        position: relative;
        inline-size: var(--touch-min);
        block-size: var(--touch-min);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;

        & input {
          position: absolute;
          opacity: 0;
          inline-size: 100%;
          block-size: 100%;
          cursor: pointer;
          margin: 0;
        }

        & .checkmark {
          inline-size: 22px;
          block-size: 22px;
          border: 2px solid var(--ctp-overlay0);
          border-radius: var(--radius-sm);
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background 0.2s, border-color 0.2s;
          pointer-events: none;

          & svg {
            inline-size: 14px;
            block-size: 14px;
            fill: none;
            stroke: var(--ctp-crust);
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
            opacity: 0;
            transition: opacity 0.15s;
          }
        }

        & input:checked + .checkmark {
          background: var(--ctp-green);
          border-color: var(--ctp-green);

          & svg {
            opacity: 1;
          }
        }
      }

      .todo-text {
        flex: 1;
        font-size: 0.95rem;
        color: var(--ctp-text);
        overflow-wrap: break-word;
      }

      .delete-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        color: var(--ctp-overlay0);
        transition: color 0.2s, background 0.2s;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        min-inline-size: var(--touch-min);
        min-block-size: var(--touch-min);
        justify-content: center;

        &:hover {
          color: var(--ctp-red);
          background: var(--ctp-surface1);
        }

        & svg {
          inline-size: 18px;
          block-size: 18px;
        }
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: var(--space-4xl) var(--space-lg);
        color: var(--ctp-overlay0);

        & .icon {
          font-size: 2.5rem;
          margin-block-end: var(--space-md);
          opacity: 0.6;
        }

        & p {
          font-size: 0.95rem;
          text-wrap: balance;
        }
      }

      /* Clear completed */
      .clear-completed {
        background: none;
        border: 1px solid var(--ctp-surface2);
        color: var(--ctp-overlay1);
        padding: var(--space-sm) var(--space-lg);
        border-radius: var(--radius-md);
        font-family: inherit;
        font-size: 0.85rem;
        cursor: pointer;
        transition: color 0.2s, border-color 0.2s;
        align-self: center;
        min-block-size: var(--touch-min);

        &:hover {
          color: var(--ctp-red);
          border-color: var(--ctp-red);
        }
      }
    }

    @layer a11y {
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }

      @media (prefers-contrast: more) {
        .todo-item {
          border: 1px solid var(--ctp-overlay0);
        }

        .filters button.active {
          border: 2px solid var(--ctp-text);
        }

        .todo-item.completed {
          opacity: 0.7;
        }
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <h1>Todo</h1>
      <span class="task-count" id="task-count" role="status" aria-live="polite"></span>
    </header>

    <div class="input-row">
      <input type="text" id="todo-input" placeholder="What needs to be done?" autocomplete="off" maxlength="500">
      <button id="add-btn">Add</button>
    </div>

    <div class="filters" role="tablist" aria-label="Filter todos">
      <button class="active" role="tab" aria-selected="true" data-filter="all">All</button>
      <button role="tab" aria-selected="false" data-filter="active">Active</button>
      <button role="tab" aria-selected="false" data-filter="completed">Done</button>
    </div>

    <ul class="todo-list" id="todo-list" aria-live="polite"></ul>

    <button class="clear-completed" id="clear-completed" style="display:none;">Clear completed</button>
  </main>

  <script>
    const STORAGE_KEY = 'catppuccin-todos';

    let todos = loadTodos();
    let currentFilter = 'all';
    let lastAddedId = null;

    const input = document.getElementById('todo-input');
    const addBtn = document.getElementById('add-btn');
    const list = document.getElementById('todo-list');
    const taskCount = document.getElementById('task-count');
    const clearBtn = document.getElementById('clear-completed');
    const filterBtns = document.querySelectorAll('.filters button');

    function loadTodos() {
      try {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
        if (!Array.isArray(data)) return [];
        return data.filter(item =>
          item && typeof item.id === 'string' &&
          typeof item.text === 'string' &&
          typeof item.completed === 'boolean'
        );
      } catch {
        return [];
      }
    }

    function save() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
      } catch {
        // localStorage quota exceeded â€” state is still in memory
      }
    }

    function addTodo(text) {
      text = text.trim();
      if (!text) return;
      const id = crypto.randomUUID();
      lastAddedId = id;
      todos.unshift({ id, text, completed: false });
      save();
      render();
      input.value = '';
      input.focus();
    }

    function toggleTodo(id) {
      const todo = todos.find(t => t.id === id);
      if (todo) todo.completed = !todo.completed;
      save();
      render();
    }

    function deleteTodo(id) {
      todos = todos.filter(t => t.id !== id);
      save();
      render();
    }

    function clearCompleted() {
      todos = todos.filter(t => !t.completed);
      save();
      render();
    }

    function getFiltered() {
      if (currentFilter === 'active') return todos.filter(t => !t.completed);
      if (currentFilter === 'completed') return todos.filter(t => t.completed);
      return todos;
    }

    function escapeAttr(str) {
      return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function render() {
      const filtered = getFiltered();
      const activeCount = todos.filter(t => !t.completed).length;
      const completedCount = todos.filter(t => t.completed).length;

      taskCount.textContent = `${activeCount} remaining`;
      clearBtn.style.display = completedCount > 0 ? '' : 'none';

      if (filtered.length === 0) {
        let msg = 'Add a task to get started';
        if (currentFilter === 'active') msg = 'No active tasks';
        if (currentFilter === 'completed') msg = 'No completed tasks';
        list.innerHTML = `
          <li class="empty-state">
            <div class="icon">${currentFilter === 'completed' ? '\u2713' : '\u2610'}</div>
            <p>${msg}</p>
          </li>`;
        lastAddedId = null;
        return;
      }

      list.innerHTML = filtered.map(todo => {
        const isNew = todo.id === lastAddedId;
        const escapedText = escapeHtml(todo.text);
        const escapedId = escapeAttr(todo.id);
        const statusLabel = todo.completed ? 'incomplete' : 'complete';
        return `
        <li class="todo-item ${todo.completed ? 'completed' : ''} ${isNew ? 'new-item' : ''}" data-id="${escapedId}">
          <label class="checkbox">
            <input type="checkbox" ${todo.completed ? 'checked' : ''} aria-label="Mark ${escapeAttr(todo.text)} as ${statusLabel}">
            <span class="checkmark">
              <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
            </span>
          </label>
          <span class="todo-text">${escapedText}</span>
          <button class="delete-btn" aria-label="Delete ${escapeAttr(todo.text)}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </li>`;
      }).join('');

      lastAddedId = null;
    }

    // Event listeners
    addBtn.addEventListener('click', () => addTodo(input.value));

    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') addTodo(input.value);
    });

    list.addEventListener('change', e => {
      if (e.target.type === 'checkbox') {
        const id = e.target.closest('.todo-item').dataset.id;
        toggleTodo(id);
      }
    });

    list.addEventListener('click', e => {
      const btn = e.target.closest('.delete-btn');
      if (btn) {
        const id = btn.closest('.todo-item').dataset.id;
        deleteTodo(id);
      }
    });

    clearBtn.addEventListener('click', clearCompleted);

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        currentFilter = btn.dataset.filter;
        render();
      });
    });

    // Initial render
    render();
  </script>
</body>
</html>
