<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#1e1e2e">
  <title>Todo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Inter:opsz,wght@14..32,400..700&display=swap" rel="stylesheet">
  <style>
    @layer reset, tokens, base, components, a11y;

    @layer reset {
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
    }

    @layer tokens {
      :root {
        /* Catppuccin Mocha palette */
        --ctp-rosewater: #f5e0dc;
        --ctp-flamingo: #f2cdcd;
        --ctp-pink: #f5c2e7;
        --ctp-mauve: #cba6f7;
        --ctp-red: #f38ba8;
        --ctp-maroon: #eba0ac;
        --ctp-peach: #fab387;
        --ctp-yellow: #f9e2af;
        --ctp-green: #a6e3a1;
        --ctp-teal: #94e2d5;
        --ctp-sky: #89dceb;
        --ctp-sapphire: #74c7ec;
        --ctp-blue: #89b4fa;
        --ctp-lavender: #b4befe;
        --ctp-text: #cdd6f4;
        --ctp-subtext1: #bac2de;
        --ctp-subtext0: #a6adc8;
        --ctp-overlay2: #9399b2;
        --ctp-overlay1: #7f849c;
        --ctp-overlay0: #6c7086;
        --ctp-surface2: #585b70;
        --ctp-surface1: #45475a;
        --ctp-surface0: #313244;
        --ctp-base: #1e1e2e;
        --ctp-mantle: #181825;
        --ctp-crust: #11111b;

        /* Font stacks */
        --font-sans: 'Inter', system-ui, sans-serif;
        --font-mono: 'DM Mono', ui-monospace, 'Cascadia Mono', 'Fira Mono', monospace;

        /* Spacing scale */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 0.75rem;
        --space-lg: 1rem;
        --space-xl: 1.25rem;
        --space-2xl: 1.5rem;
        --space-3xl: 2rem;
        --space-4xl: 3rem;

        /* Radii */
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 12px;
        --radius-full: 999px;

        /* Touch target minimum */
        --touch-min: 44px;
      }
    }

    @layer base {
      body {
        font-family: var(--font-sans);
        font-optical-sizing: auto;
        background-color: var(--ctp-base);
        color: var(--ctp-text);
        line-height: 1.5;
        letter-spacing: -0.011em;
        min-block-size: 100dvh;
        display: flex;
        flex-direction: column;
        align-items: center;
        -webkit-tap-highlight-color: transparent;
      }

      code, kbd, samp, pre {
        font-family: var(--font-mono);
        font-size: 0.9em;
      }
    }

    @layer components {
      /* App shell */
      main.app {
        inline-size: 100%;
        max-inline-size: 600px;
        padding: var(--space-2xl) var(--space-lg) env(safe-area-inset-bottom, var(--space-2xl));
        display: flex;
        flex-direction: column;
        gap: var(--space-xl);
      }

      /* Header */
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;

        & h1 {
          font-size: clamp(1.75rem, 1.5rem + 1vw, 2.25rem);
          font-weight: 700;
          color: var(--ctp-mauve);
          letter-spacing: -0.025em;
          text-wrap: balance;
        }
      }

      .task-count {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--ctp-overlay1);
        background: var(--ctp-surface0);
        padding: var(--space-xs) var(--space-md);
        border-radius: var(--radius-full);
        letter-spacing: 0;
      }

      /* Input area */
      .input-row {
        display: flex;
        gap: var(--space-sm);

        & input[type="text"] {
          flex: 1;
          padding: var(--space-md) var(--space-lg);
          border: 2px solid var(--ctp-surface1);
          border-radius: var(--radius-lg);
          background: var(--ctp-surface0);
          color: var(--ctp-text);
          font-family: inherit;
          font-size: 1rem;
          line-height: 1.5;
          outline: none;
          transition: border-color 0.2s;

          &:focus {
            border-color: var(--ctp-mauve);
            outline: 2px solid var(--ctp-mauve);
            outline-offset: 2px;
          }

          &::placeholder {
            color: var(--ctp-overlay0);
          }
        }

        & button {
          padding: var(--space-md) var(--space-xl);
          border: none;
          border-radius: var(--radius-lg);
          background: var(--ctp-mauve);
          color: var(--ctp-crust);
          font-family: inherit;
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.2s, transform 0.1s;
          white-space: nowrap;

          &:hover {
            background: color-mix(in oklch, var(--ctp-mauve), var(--ctp-lavender) 50%);
          }

          &:active {
            transform: scale(0.96);
          }
        }
      }

      /* Options row (category + due date) */
      .options-row {
        display: flex;
        gap: var(--space-sm);
        flex-wrap: wrap;
      }

      .options-row select,
      .options-row input[type="date"] {
        padding: var(--space-sm) var(--space-md);
        border: 2px solid var(--ctp-surface1);
        border-radius: var(--radius-md);
        background: var(--ctp-surface0);
        color: var(--ctp-text);
        font-family: inherit;
        font-size: 0.85rem;
        outline: none;
        transition: border-color 0.2s;
        min-block-size: var(--touch-min);

        &:focus {
          border-color: var(--ctp-mauve);
          outline: 2px solid var(--ctp-mauve);
          outline-offset: 2px;
        }
      }

      .options-row select {
        flex: 1;
        min-inline-size: 0;
        cursor: pointer;
      }

      .options-row input[type="date"] {
        flex: 1;
        min-inline-size: 0;
        color-scheme: dark;

        &::-webkit-calendar-picker-indicator {
          filter: invert(0.7);
          cursor: pointer;
        }
      }

      /* Focus outlines for keyboard navigation */
      :focus-visible {
        outline: 2px solid var(--ctp-mauve);
        outline-offset: 2px;
      }

      /* Filter and sort bar */
      .toolbar {
        display: flex;
        gap: var(--space-sm);
        align-items: stretch;
      }

      .filters {
        display: flex;
        gap: var(--space-xs);
        background: var(--ctp-mantle);
        padding: var(--space-xs);
        border-radius: var(--radius-lg);
        flex: 1;

        & button {
          flex: 1;
          padding-block: 0.65rem;
          padding-inline: var(--space-sm);
          border: none;
          border-radius: var(--radius-md);
          background: transparent;
          color: var(--ctp-overlay1);
          font-family: inherit;
          font-size: 0.85rem;
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s, color 0.2s;
          min-block-size: var(--touch-min);

          &.active {
            background: var(--ctp-surface0);
            color: var(--ctp-text);
          }

          &:hover:not(.active) {
            color: var(--ctp-subtext0);
          }
        }
      }

      .sort-select {
        padding: var(--space-sm) var(--space-md);
        border: none;
        border-radius: var(--radius-lg);
        background: var(--ctp-mantle);
        color: var(--ctp-overlay1);
        font-family: inherit;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        outline: none;
        min-block-size: var(--touch-min);
        transition: color 0.2s;

        &:focus {
          outline: 2px solid var(--ctp-mauve);
          outline-offset: 2px;
        }

        &:hover {
          color: var(--ctp-subtext0);
        }
      }

      /* Category filter bar */
      .category-filters {
        display: flex;
        gap: var(--space-xs);
        overflow-x: auto;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        padding-block: 2px;

        &::-webkit-scrollbar {
          display: none;
        }

        & button {
          padding: var(--space-xs) var(--space-md);
          border: 1.5px solid var(--ctp-surface2);
          border-radius: var(--radius-full);
          background: transparent;
          color: var(--ctp-overlay1);
          font-family: inherit;
          font-size: 0.75rem;
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s, color 0.2s, border-color 0.2s;
          white-space: nowrap;
          min-block-size: 32px;

          &.active {
            background: var(--ctp-surface0);
            color: var(--ctp-text);
            border-color: var(--ctp-surface0);
          }

          &:hover:not(.active) {
            color: var(--ctp-subtext0);
            border-color: var(--ctp-overlay0);
          }
        }
      }

      /* Todo list */
      .todo-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
      }

      .todo-item {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        padding: 0.85rem var(--space-lg);
        background: var(--ctp-surface0);
        border-radius: var(--radius-lg);
        transition: background 0.2s, opacity 0.3s, transform 0.3s;

        &.new-item {
          animation: slide-in 0.25s ease-out;
        }

        &.completed {
          opacity: 0.55;

          & .todo-text {
            text-decoration: line-through;
            color: var(--ctp-overlay0);
          }
        }
      }

      @keyframes slide-in {
        from { opacity: 0; transform: translateY(-8px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Custom checkbox */
      .checkbox {
        position: relative;
        inline-size: var(--touch-min);
        block-size: var(--touch-min);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;

        & input {
          position: absolute;
          opacity: 0;
          inline-size: 100%;
          block-size: 100%;
          cursor: pointer;
          margin: 0;
        }

        & .checkmark {
          inline-size: 22px;
          block-size: 22px;
          border: 2px solid var(--ctp-overlay0);
          border-radius: var(--radius-sm);
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background 0.2s, border-color 0.2s;
          pointer-events: none;

          & svg {
            inline-size: 14px;
            block-size: 14px;
            fill: none;
            stroke: var(--ctp-crust);
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
            opacity: 0;
            transition: opacity 0.15s;
          }
        }

        & input:checked + .checkmark {
          background: var(--ctp-green);
          border-color: var(--ctp-green);

          & svg {
            opacity: 1;
          }
        }
      }

      .todo-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
        overflow: hidden;
      }

      .todo-text {
        font-size: 0.95rem;
        color: var(--ctp-text);
        overflow-wrap: break-word;
      }

      .todo-meta {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        flex-wrap: wrap;
      }

      .category-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 0.7rem;
        font-weight: 500;
        padding: 1px var(--space-sm);
        border-radius: var(--radius-full);
        background: color-mix(in oklch, var(--badge-color) 15%, transparent);
        color: var(--badge-color);
        letter-spacing: 0.01em;
      }

      .category-dot {
        inline-size: 6px;
        block-size: 6px;
        border-radius: 50%;
        background: var(--badge-color);
      }

      .countdown {
        font-family: var(--font-mono);
        font-size: 0.7rem;
        font-weight: 500;
        padding: 1px var(--space-sm);
        border-radius: var(--radius-full);
        letter-spacing: 0;
      }

      .countdown.overdue {
        background: color-mix(in oklch, var(--ctp-red) 15%, transparent);
        color: var(--ctp-red);
      }

      .countdown.due-soon {
        background: color-mix(in oklch, var(--ctp-peach) 15%, transparent);
        color: var(--ctp-peach);
      }

      .countdown.due-later {
        background: color-mix(in oklch, var(--ctp-green) 15%, transparent);
        color: var(--ctp-green);
      }

      .delete-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        color: var(--ctp-overlay0);
        transition: color 0.2s, background 0.2s;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        min-inline-size: var(--touch-min);
        min-block-size: var(--touch-min);
        justify-content: center;

        &:hover {
          color: var(--ctp-red);
          background: var(--ctp-surface1);
        }

        & svg {
          inline-size: 18px;
          block-size: 18px;
        }
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: var(--space-4xl) var(--space-lg);
        color: var(--ctp-overlay0);

        & .icon {
          font-size: 2.5rem;
          margin-block-end: var(--space-md);
          opacity: 0.6;
        }

        & p {
          font-size: 0.95rem;
          text-wrap: balance;
        }
      }

      /* Clear completed */
      .clear-completed {
        background: none;
        border: 1px solid var(--ctp-surface2);
        color: var(--ctp-overlay1);
        padding: var(--space-sm) var(--space-lg);
        border-radius: var(--radius-md);
        font-family: inherit;
        font-size: 0.85rem;
        cursor: pointer;
        transition: color 0.2s, border-color 0.2s;
        align-self: center;
        min-block-size: var(--touch-min);

        &:hover {
          color: var(--ctp-red);
          border-color: var(--ctp-red);
        }
      }
    }

    @layer a11y {
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }

      @media (prefers-contrast: more) {
        .todo-item {
          border: 1px solid var(--ctp-overlay0);
        }

        .filters button.active {
          border: 2px solid var(--ctp-text);
        }

        .todo-item.completed {
          opacity: 0.7;
        }
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <h1>Todo</h1>
      <span class="task-count" id="task-count" role="status" aria-live="polite"></span>
    </header>

    <div class="input-row">
      <input type="text" id="todo-input" placeholder="What needs to be done?" autocomplete="off" maxlength="500">
      <button id="add-btn">Add</button>
    </div>

    <div class="options-row">
      <select id="category-select" aria-label="Category">
        <option value="general">General</option>
        <option value="work">Work</option>
        <option value="personal">Personal</option>
        <option value="health">Health</option>
        <option value="finance">Finance</option>
        <option value="learning">Learning</option>
      </select>
      <input type="date" id="due-date-input" aria-label="Due date (optional)">
    </div>

    <div class="toolbar">
      <div class="filters" role="tablist" aria-label="Filter todos">
        <button class="active" role="tab" aria-selected="true" data-filter="all">All</button>
        <button role="tab" aria-selected="false" data-filter="active">Active</button>
        <button role="tab" aria-selected="false" data-filter="completed">Done</button>
      </div>
      <select class="sort-select" id="sort-select" aria-label="Sort todos">
        <option value="newest">Newest</option>
        <option value="oldest">Oldest</option>
        <option value="alpha-az">A &rarr; Z</option>
        <option value="alpha-za">Z &rarr; A</option>
        <option value="category">Category</option>
        <option value="due-date">Due date</option>
      </select>
    </div>

    <div class="category-filters" id="category-filters" aria-label="Filter by category">
      <button class="active" data-category="all">All</button>
      <button data-category="work">Work</button>
      <button data-category="personal">Personal</button>
      <button data-category="health">Health</button>
      <button data-category="finance">Finance</button>
      <button data-category="learning">Learning</button>
    </div>

    <ul class="todo-list" id="todo-list" aria-live="polite"></ul>

    <button class="clear-completed" id="clear-completed" style="display:none;">Clear completed</button>
  </main>

  <script>
    const STORAGE_KEY = 'catppuccin-todos';

    const CATEGORIES = {
      general:  { label: 'General',  color: 'var(--ctp-overlay2)' },
      work:     { label: 'Work',     color: 'var(--ctp-blue)' },
      personal: { label: 'Personal', color: 'var(--ctp-mauve)' },
      health:   { label: 'Health',   color: 'var(--ctp-green)' },
      finance:  { label: 'Finance',  color: 'var(--ctp-yellow)' },
      learning: { label: 'Learning', color: 'var(--ctp-sapphire)' },
    };

    let todos = loadTodos();
    let currentFilter = 'all';
    let currentCategory = 'all';
    let currentSort = 'newest';
    let lastAddedId = null;

    const input = document.getElementById('todo-input');
    const addBtn = document.getElementById('add-btn');
    const list = document.getElementById('todo-list');
    const taskCount = document.getElementById('task-count');
    const clearBtn = document.getElementById('clear-completed');
    const filterBtns = document.querySelectorAll('.filters button');
    const categorySelect = document.getElementById('category-select');
    const dueDateInput = document.getElementById('due-date-input');
    const sortSelect = document.getElementById('sort-select');
    const categoryFilterBtns = document.querySelectorAll('#category-filters button');

    function loadTodos() {
      try {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
        if (!Array.isArray(data)) return [];
        return data
          .filter(item =>
            item && typeof item.id === 'string' &&
            typeof item.text === 'string' &&
            typeof item.completed === 'boolean'
          )
          .map(item => ({
            id: item.id,
            text: item.text,
            completed: item.completed,
            category: item.category && CATEGORIES[item.category] ? item.category : 'general',
            createdAt: item.createdAt || Date.now(),
            dueDate: item.dueDate || null,
          }));
      } catch {
        return [];
      }
    }

    function save() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
      } catch {
        // localStorage quota exceeded â€” state is still in memory
      }
    }

    function addTodo(text) {
      text = text.trim();
      if (!text) return;
      const id = crypto.randomUUID();
      lastAddedId = id;
      const category = categorySelect.value;
      const dueDate = dueDateInput.value || null;
      todos.unshift({ id, text, completed: false, category, createdAt: Date.now(), dueDate });
      save();
      render();
      input.value = '';
      dueDateInput.value = '';
      input.focus();
    }

    function toggleTodo(id) {
      const todo = todos.find(t => t.id === id);
      if (todo) todo.completed = !todo.completed;
      save();
      render();
    }

    function deleteTodo(id) {
      todos = todos.filter(t => t.id !== id);
      save();
      render();
    }

    function clearCompleted() {
      todos = todos.filter(t => !t.completed);
      save();
      render();
    }

    function getFiltered() {
      let result = todos;

      if (currentFilter === 'active') result = result.filter(t => !t.completed);
      if (currentFilter === 'completed') result = result.filter(t => t.completed);

      if (currentCategory !== 'all') {
        result = result.filter(t => t.category === currentCategory);
      }

      return result;
    }

    function getSorted(items) {
      const sorted = [...items];
      switch (currentSort) {
        case 'newest':
          sorted.sort((a, b) => b.createdAt - a.createdAt);
          break;
        case 'oldest':
          sorted.sort((a, b) => a.createdAt - b.createdAt);
          break;
        case 'alpha-az':
          sorted.sort((a, b) => a.text.localeCompare(b.text));
          break;
        case 'alpha-za':
          sorted.sort((a, b) => b.text.localeCompare(a.text));
          break;
        case 'category':
          sorted.sort((a, b) => a.category.localeCompare(b.category));
          break;
        case 'due-date':
          sorted.sort((a, b) => {
            if (!a.dueDate && !b.dueDate) return 0;
            if (!a.dueDate) return 1;
            if (!b.dueDate) return -1;
            return a.dueDate.localeCompare(b.dueDate);
          });
          break;
      }
      return sorted;
    }

    function formatCountdown(dueDate) {
      if (!dueDate) return null;
      const now = new Date();
      const due = new Date(dueDate + 'T23:59:59');
      const diffMs = due - now;
      const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));

      let text;
      let cls;

      if (diffDays < 0) {
        const overdueDays = Math.abs(diffDays);
        text = overdueDays === 1 ? '1d overdue' : `${overdueDays}d overdue`;
        cls = 'overdue';
      } else if (diffDays === 0) {
        text = 'Due today';
        cls = 'due-soon';
      } else if (diffDays === 1) {
        text = 'Due tomorrow';
        cls = 'due-soon';
      } else if (diffDays <= 3) {
        text = `${diffDays}d left`;
        cls = 'due-soon';
      } else {
        text = `${diffDays}d left`;
        cls = 'due-later';
      }

      return { text, cls };
    }

    function escapeAttr(str) {
      return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function render() {
      const filtered = getSorted(getFiltered());
      const activeCount = todos.filter(t => !t.completed).length;
      const completedCount = todos.filter(t => t.completed).length;

      taskCount.textContent = `${activeCount} remaining`;
      clearBtn.style.display = completedCount > 0 ? '' : 'none';

      if (filtered.length === 0) {
        let msg = 'Add a task to get started';
        if (currentFilter === 'active') msg = 'No active tasks';
        if (currentFilter === 'completed') msg = 'No completed tasks';
        if (currentCategory !== 'all') msg = `No ${CATEGORIES[currentCategory]?.label || ''} tasks`.trim();
        list.innerHTML = `
          <li class="empty-state">
            <div class="icon">${currentFilter === 'completed' ? '\u2713' : '\u2610'}</div>
            <p>${msg}</p>
          </li>`;
        lastAddedId = null;
        return;
      }

      list.innerHTML = filtered.map(todo => {
        const isNew = todo.id === lastAddedId;
        const escapedText = escapeHtml(todo.text);
        const escapedId = escapeAttr(todo.id);
        const statusLabel = todo.completed ? 'incomplete' : 'complete';
        const cat = CATEGORIES[todo.category] || CATEGORIES.general;
        const countdown = formatCountdown(todo.dueDate);

        let metaHtml = '';
        const hasMeta = todo.category !== 'general' || countdown;
        if (hasMeta) {
          metaHtml = '<div class="todo-meta">';
          if (todo.category !== 'general') {
            metaHtml += `<span class="category-badge" style="--badge-color: ${cat.color}"><span class="category-dot"></span>${escapeHtml(cat.label)}</span>`;
          }
          if (countdown) {
            metaHtml += `<span class="countdown ${countdown.cls}">${escapeHtml(countdown.text)}</span>`;
          }
          metaHtml += '</div>';
        }

        return `
        <li class="todo-item ${todo.completed ? 'completed' : ''} ${isNew ? 'new-item' : ''}" data-id="${escapedId}">
          <label class="checkbox">
            <input type="checkbox" ${todo.completed ? 'checked' : ''} aria-label="Mark ${escapeAttr(todo.text)} as ${statusLabel}">
            <span class="checkmark">
              <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
            </span>
          </label>
          <div class="todo-content">
            <span class="todo-text">${escapedText}</span>
            ${metaHtml}
          </div>
          <button class="delete-btn" aria-label="Delete ${escapeAttr(todo.text)}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </li>`;
      }).join('');

      lastAddedId = null;
    }

    // Event listeners
    addBtn.addEventListener('click', () => addTodo(input.value));

    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') addTodo(input.value);
    });

    list.addEventListener('change', e => {
      if (e.target.type === 'checkbox') {
        const id = e.target.closest('.todo-item').dataset.id;
        toggleTodo(id);
      }
    });

    list.addEventListener('click', e => {
      const btn = e.target.closest('.delete-btn');
      if (btn) {
        const id = btn.closest('.todo-item').dataset.id;
        deleteTodo(id);
      }
    });

    clearBtn.addEventListener('click', clearCompleted);

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        currentFilter = btn.dataset.filter;
        render();
      });
    });

    sortSelect.addEventListener('change', () => {
      currentSort = sortSelect.value;
      render();
    });

    categoryFilterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        categoryFilterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.category;
        render();
      });
    });

    // Update countdowns every minute
    setInterval(() => render(), 60_000);

    // Initial render
    render();
  </script>
</body>
</html>
